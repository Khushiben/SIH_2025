<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Consumer Marketplace - AgriDirect</title>

  <style>
    body { font-family: 'Segoe UI', sans-serif; background:#f8f9fa; margin:0; }

    /* NAVBAR */
    nav { 
      display:flex; justify-content:space-between; align-items:center; 
      background:#5D8736; padding:15px 30px; position:static; top:0; z-index:1000;
    }
    .logo { display:flex; align-items:center; }
    .logo video { width:50px; height:50px; border-radius:5px; margin-right:10px; }
    .logo-text { color:white; font-size:24px; font-weight:bold; }
    nav ul { list-style:none; display:flex; gap:20px; margin:0; padding:0; }
    nav ul li a { color:white; text-decoration:none; font-weight:bold; }
    nav ul li a:hover { color:#F4FFC3; }

    /* PRODUCT GRID */
    .container { padding:30px; max-width:1400px; margin:auto; }
    h2 { text-align:center; color:#2d6a4f; margin-bottom:20px; }

    .product-grid {
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(300px,1fr));
      gap:20px;
    }

    /* CARD STYLING */
    .card-container { perspective:1000px; }

    .product-card {
      width:100%; height:520px; background:white;
      border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1);
      position:relative; transform-style:preserve-3d;
      transition:transform 0.8s;
    }
    .product-card:hover { transform:scale(1.02); }

    .product-card.is-flipped { transform:rotateY(180deg); }

    .card-side {
      position:absolute; width:100%; height:100%; backface-visibility:hidden;
      border-radius:12px; padding:15px; box-sizing:border-box; background:white;
    }

    .card-front img {
      width:100%; height:200px; object-fit:cover; border-radius:8px;
    }

    .card-back { transform:rotateY(180deg); text-align:center; }

    .price { color:#d00000; font-size:18px; font-weight:bold; }

    .btn-order {
      padding:10px; border:none; width:49%; background:#2d6a4f; color:white;
      border-radius:8px; cursor:pointer; transition:0.3s;
    }
    .btn-order:hover { background:#1b4332; }


    .btn-back {
      margin-top:10px; padding:8px 12px; border:2px solid #2d6a4f;
      background:white; color:#2d6a4f; border-radius:8px; cursor:pointer;
    }

    /* FOOTER */
    footer {
      margin-top: 30px; background:white; color:#809D3C; padding:30px 20px;
      text-align:center; border-top:2px solid #5D8736;
    }
    .footer-container {
      display:flex; justify-content:space-between; flex-wrap:wrap;
      max-width:1200px; margin:auto;
    }
    .footer-logo { display:flex; align-items:center; font-size:22px; font-weight:bold; }
    .footer-logo video { width:50px; height:50px; margin-right:10px; border-radius:5px; }
    /* Hide Google logo and branding in the translate widget */
        #google_translate_element .goog-logo-link,
        #google_translate_element .goog-te-gadget span {
          display: none !important;
        }

        /* Remove extra margin/padding from the widget */
        #google_translate_element {
          margin: 0 !important;
          padding: 5px !important;
          min-width: 120px;
          max-width: 180px;
          font-size: 0.95em;
        }

        /* Make dropdown blend with navbar */
        .goog-te-combo {
          border-radius: 6px !important;
          border: 1.5px solid #e2c106 !important;
          padding: 6px 12px !important;
          background: #fff !important;
          color: #2d6a4f !important;
          font-weight: 500 !important;
          font-family: inherit !important;
          outline: none !important;
          transition: border-color 0.3s;
        }
        .goog-te-combo:focus {
          border-color: #5D8736 !important;
        }

        /* Prevent widget from overlapping content */
        body #google_translate_element {
          z-index: 10;
          position: relative;
        }
  </style>
</head>

<body>

<!-- NAVBAR -->
<nav>
  <div class="logo">
    <video autoplay loop muted>
      <source src="image/agridirect.mp4" type="video/mp4">
    </video>
    <span class="logo-text">AgriDirect</span>
  </div>

  <ul>
    <li><a href="shared_homepage.html">HOME</a></li>
    <li><a href="marketplace.html">MARKETPLACE</a></li>
    <li><a id="dashboardLink" href="#">DASHBOARD</a></li>
    <li><a href="about_us.html">ABOUT US</a></li>
    <li><a id="authLink" href="role.html">LOGIN/SIGN UP</a></li>
    <li>
          <div id="google_translate_element" style="display:inline-block; vertical-align:middle;"></div>
        </li>
  </ul>
</nav>
<script>function googleTranslateElementInit() {
        new google.translate.TranslateElement({pageLanguage: 'en'}, 'google_translate_element');
      }</script>
      <script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>


<div class="container">
  <h2>Retailer Products Marketplace</h2>
  <div class="product-grid" id="productGrid"></div>
</div>

<!-- FOOTER -->
<footer>
  <div class="footer-container">
    <div class="footer-logo">
      <video autoplay loop muted>
        <source src="image/logo.mp4" type="video/mp4">
      </video>
      <span>AgriDirect</span>
    </div>
  </div>
  <p>&copy; 2025 AgriDirect. All Rights Reserved.</p>
</footer>

<script>
async function loadRetailerMarketplace() {
  try {
    const res = await fetch("http://localhost:5000/api/consumer/retailer-products");
    const data = await res.json();

    const grid = document.getElementById("productGrid");
    grid.innerHTML = "";

    if (!data.success || data.products.length === 0) {
      grid.innerHTML = "<h3 style='text-align:center;color:#666;'>No products available</h3>";
      return;
    }

    data.products.forEach(p => {
      const card = document.createElement("div");
      card.className = "card-container";

      card.innerHTML = `
        <div class="product-card">
          <div class="card-side card-front">
            <img src="${p.image}" alt="${p.productName}">
            <h3>${p.productName}</h3>
            <p>${p.description}</p>
            <p class="price">â‚¹${p.price}</p>
            <button class="btn-order" onclick="buyNow('${encodeURIComponent(JSON.stringify(p))}')">Buy Now</button>
            <button class="btn-order" onclick="flipCard(this)">Farmer Info</button>
          </div>
        </div>
      `;

      card.querySelector(".product-card").addEventListener("click", e => {
        if (!e.target.closest("button")) card.querySelector(".product-card").classList.toggle("is-flipped");
      });

      grid.appendChild(card);
    });
  } catch (err) {
    console.error(err);
    alert("Failed to load products.");
  }
}

function flipCard(btn) {
  btn.closest(".product-card").classList.add("is-flipped");
}
function unflipCard(btn) {
  btn.closest(".product-card").classList.remove("is-flipped");
}

function buyNow(encodedProduct) {
  const product = JSON.parse(decodeURIComponent(encodedProduct));
  const query = new URLSearchParams({
    id: product.id,
    name: product.productName,
    price: product.price,
    image: product.image,
    farmer: product.farmer
  }).toString();
  window.location.href = `consumer_checkout.html?${query}`;
}

// NAVBAR LOGIN/LOGOUT LOGIC
document.addEventListener("DOMContentLoaded", () => {
  const dashboardLink = document.getElementById("dashboardLink");
  const authLink = document.getElementById("authLink");
  const role = localStorage.getItem("userRole");

  if (role === "consumer") dashboardLink.href = "consumer_dashboard.html";
  else dashboardLink.href = "role.html";

  if (role) {
    authLink.textContent = "LOGOUT";
    authLink.href = "#";
    authLink.onclick = () => {
      localStorage.clear();
      window.location.href = "shared_homepage.html";
    };
  }
});

loadRetailerMarketplace();
</script>

</body>
</html>
