<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add Product to Marketplace</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            background:#f6fff6;
            margin:0;
            padding-bottom:80px; /* footer space */
        }

        /* NAVBAR */
        nav {
            display:flex;
            justify-content:space-between;
            align-items:center;
            background:#5D8736;
            padding:15px 30px;
            font-size: larger;
        }
        .logo {
            display:flex;
            align-items:center;
        }
        .logo video {
            width:50px;
            height:50px;
            margin-right:10px;
            border-radius:5px;
        }
        .logo-text {
            font-size:24px;
            font-weight:bold;
            color:white;
        }
        nav ul { list-style:none; display:flex; }
        nav ul li { margin:0 15px; }
        nav ul li a {
            text-decoration:none;
            color:white;
            font-weight:bold;
        }
        nav ul li a:hover { color:#F4FFC3; }

        /* FORM CONTAINER */
        .container {
            width:90%;
            max-width:600px;
            background:white;
            padding:25px;
            margin:40px auto;
            border-radius:12px;
            box-shadow:0 3px 10px rgba(0,0,0,0.15);
        }

        input, textarea {
            width:100%;
            padding:12px;
            margin-top:10px;
            border-radius:6px;
            border:1px solid #ccc;
            font-size:15px;
        }
        input[readonly] {
            background:#f2f2f2;
            cursor:not-allowed;
        }

        button {
            width:100%;
            padding:14px;
            background:#5D8736;
            color:white;
            border:none;
            border-radius:8px;
            margin-top:20px;
            font-size:18px;
            cursor:pointer;
        }
        button:hover { background:#4a6e2b; }

        /* FOOTER */
        footer {
            background:white;
            color:#809D3C;
            padding:30px 20px;
            text-align:center;
            border-top:2px solid #5D8736;
            position: static;
            bottom:0;
            width:100%;
        }
        .footer-container {
            display:flex;
            justify-content:space-between;
            align-items:center;
            flex-wrap:wrap;
            max-width:1200px;
            margin:auto;
        }
        .footer-logo {
            display:flex;
            align-items:center;
            font-size:22px;
            font-weight:bold;
        }
        .footer-logo video {
            width:50px;
            height:50px;
            margin-right:10px;
            border-radius:5px;
        }
        .footer-social img {
            width:30px;
            margin:0 10px;
            transition:transform .3s;
        }
        .footer-social img:hover { transform:scale(1.2); }
        .footer-copy { margin-top:15px; font-size:14px; opacity:0.8; }
        /* Hide Google logo and branding in the translate widget */
        #google_translate_element .goog-logo-link,
        #google_translate_element .goog-te-gadget span {
          display: none !important;
        }

        /* Remove extra margin/padding from the widget */
        #google_translate_element {
          margin: 0 !important;
          padding: 5px !important;
          min-width: 120px;
          max-width: 180px;
          font-size: 0.95em;
        }

        /* Make dropdown blend with navbar */
        .goog-te-combo {
          border-radius: 6px !important;
          border: 1.5px solid #e2c106 !important;
          padding: 6px 12px !important;
          background: #fff !important;
          color: #2d6a4f !important;
          font-weight: 500 !important;
          font-family: inherit !important;
          outline: none !important;
          transition: border-color 0.3s;
        }
        .goog-te-combo:focus {
          border-color: #5D8736 !important;
        }

        /* Prevent widget from overlapping content */
        body #google_translate_element {
          z-index: 10;
          position: relative;
        }
    </style>
</head>

<body>

<!-- NAVBAR -->
<header>
    <nav>
        <div class="logo">
            <video autoplay loop muted>
                <source src="image/agridirect.mp4" type="video/mp4">
            </video>
            <span class="logo-text">AgriDirect</span>
        </div>

        <ul>
            <li><a href="shared_homepage.html">HOME</a></li>
            <li><a href="marketplace.html">MARKETPLACE</a></li>
            <li><a id="dashboardLink" href="#">DASHBOARD</a></li>
            <li><a href="about_us.html">ABOUT US</a></li>
            <li><a id="authLink" href="role.html">LOGIN/SIGN UP</a></li>
            <li>
          <div id="google_translate_element" style="display:inline-block; vertical-align:middle;"></div>
        </li> </ul>
        </ul>
    </nav>
</header>
<script>function googleTranslateElementInit() {
        new google.translate.TranslateElement({pageLanguage: 'en'}, 'google_translate_element');
      }</script>
      <script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<!-- MAIN FORM -->
<div class="container">
    <h2>Add Product to Marketplace</h2>

    <form id="addStockForm" enctype="multipart/form-data">

        <label>Product Name</label>
        <input type="text" id="productName" name="productName" readonly>

        <label>Buying Price (from Distributor)</label>
        <input type="number" id="buyingPrice" name="buyingPrice" readonly>

        <label>Selling Price (Retailer Price)</label>
        <input type="number" id="sellingPrice" name="sellingPrice" required>

        <label>Quantity Available</label>
        <input type="number" id="quantity" name="quantity" required>

        <label>Product Description</label>
        <textarea id="description" name="description" rows="4"></textarea>

        <label>Product Image</label>
        <input type="file" id="image" name="image">

        <input type="hidden" id="retailerId" name="retailerId">
        <input type="hidden" id="orderId" name="orderId">
        <input type="hidden" id="productId" name="productId"> <!-- added -->

        <button type="submit">Add to Marketplace</button>
    </form>
</div>

<!-- FOOTER -->
<footer>
    <div class="footer-container">
        <div class="footer-logo">
            <video autoplay loop muted playsinline>
                <source src="image/logo.mp4" type="video/mp4">
            </video>
            <span>AgriDirect</span>
        </div>

        <div class="footer-contact">
            <h3>Contact Us</h3>
            <p>Email: support@agriDirect.com</p>
            <p>Phone: +91 10101 01010</p>
        </div>

        <div class="footer-social">
            <h3>Follow Us</h3>
            <a href="#"><img src="image/linkedin.png" /></a>
            <a href="#"><img src="image/twitter.png" /></a>
            <a href="#"><img src="image/instagram.png" /></a>
            <a href="#"><img src="image/youtube.png" /></a>
        </div>
    </div>

    <p class="footer-copy">&copy; 2025 Agridirect. All Rights Reserved.</p>
</footer>

<script>
// Read from localStorage once
const orderData = JSON.parse(localStorage.getItem("addMarketplaceData"));

if(!orderData || !orderData.productId || !orderData.orderId){
    alert("Missing product or order information! Go back to My Orders page.");
    window.location.href = "my_retailer_orders.html";
} else {
    document.getElementById("productName").value = orderData.product;
    document.getElementById("buyingPrice").value = orderData.price;
    document.getElementById("orderId").value = orderData.orderId;
    document.getElementById("productId").value = orderData.productId;
    document.getElementById("retailerId").value = localStorage.getItem("retailerId");
}

console.log("ProductId:", document.getElementById("productId").value);

// Safety check before submit
document.getElementById("addStockForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const retailerId = document.getElementById("retailerId").value;
    const productId = document.getElementById("productId").value;
    const orderId = document.getElementById("orderId").value;

    if(!retailerId){
        alert("Please login first!");
        window.location.href = "retailer_login.html";
        return;
    }

    if(!productId || !orderId){
        alert("Missing product or order information!");
        window.history.back();
        return;
    }

    const formData = new FormData(e.target);

    // Convert numeric fields explicitly
    formData.set("buyingPrice", Number(document.getElementById("buyingPrice").value));
    formData.set("sellingPrice", Number(document.getElementById("sellingPrice").value));
    formData.set("quantity", Number(document.getElementById("quantity").value));

    try {
        const res = await fetch("http://localhost:5000/retailer/add-marketplace", {
            method: "POST",
            body: formData
        });

        const data = await res.json();

        if (data.success) {
            alert("Product added to consumer marketplace!");
            window.location.href = "retailer_dashboard.html";
        } else {
            alert("Error: " + data.message);
        }
    } catch (err) {
        console.error(err);
        alert("Something went wrong while adding the product!");
    }
});

</script>
</body>
</html>
